{% load static %}

<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Î•Ï€Î¹Î»Î¿Î³Î® Î‘Ï…Ï„Î¿ÎºÎ¹Î½Î®Ï„Î¿Ï…</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'rentals/style.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        .settings-container { position: absolute; top: 20px; right: 20px; }
        .settings-button {
            background-color: var(--logout-bg); color: var(--button-text);
            border: none; padding: 0.5rem 0.8rem; border-radius: 8px;
            cursor: pointer; font-size: 1rem;
        }
        .settings-button:hover { background-color: var(--logout-hover); }
        .settings-menu {
            display: none; position: absolute; top: 50px; right: 0;
            background-color: var(--container-bg); border: 1px solid var(--card-border);
            border-radius: 8px; padding: 0.8rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 999;
        }
        .settings-menu.show { display: block; }
        .settings-menu button { display: block; width: 100%; margin-bottom: 0.5rem; }
        .car-list li { cursor: pointer; }
        .car-list li .meta { opacity: .85; }
        .nav-actions { margin: 0.8rem 0 1.2rem; display:flex; gap:.6rem; flex-wrap:wrap; align-items:center; }
        .btn { padding:.45rem .8rem; border-radius:8px; text-decoration:none; display:inline-block; }
        .btn.primary { background: var(--btn-bg, #2563eb); color: var(--btn-text, #fff); }
        .btn.secondary { background: var(--container-bg); border:1px solid var(--card-border); color: inherit; }

        /* â• Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·: ÏƒÏ…Î½Î¿Ï€Ï„Î¹ÎºÎ¬ counts ÏƒÏ„Î¿ ÎºÎ­Î½Ï„ÏÎ¿ */
        .counts-summary{
            text-align:center; font-weight:600; margin:.6rem 0 1rem;
        }
        .counts-summary .dot{ margin:0 .6rem; color:#999; }
    </style>
</head>
<body>
    <!-- âš™ï¸ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ -->
    <div class="settings-container">
        <button class="settings-button" onclick="toggleSettingsMenu()">âš™ï¸ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚</button>
        <div class="settings-menu" id="settingsMenu">
            <form action="{% url 'rentals:logout_company' %}" method="post">
                {% csrf_token %}
                <button type="submit"><i class="fas fa-sign-out-alt"></i> Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</button>
            </form>
            <button onclick="toggleTheme()">ğŸŒ“ Î•Î½Î±Î»Î»Î±Î³Î® Î˜Î­Î¼Î±Ï„Î¿Ï‚</button>
        </div>
    </div>

    <div class="container">
        <h1><i class="fas fa-car"></i> Î•Ï€Î¹Î»Î¿Î³Î® Î‘Ï…Ï„Î¿ÎºÎ¹Î½Î®Ï„Î¿Ï…</h1>

        {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                    <li class="{{ message.tags }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <form method="get">
            {{ form.as_p }}
            <button type="submit"><i class="fas fa-search"></i> Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</button>
        </form>

        <!-- ğŸ”— Î Î»Î¿Î®Î³Î·ÏƒÎ· -->
        <div class="nav-actions">
            <a class="btn primary" href="{% url 'rentals:bookings_list' %}">
                <i class="fas fa-calendar-check"></i> Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎšÏÎ±Ï„Î®ÏƒÎµÏ‰Î½
            </a>
            <a class="btn secondary" href="{% url 'rentals:add_car' %}">
                <i class="fas fa-plus-circle"></i> Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎŸÏ‡Î®Î¼Î±Ï„Î¿Ï‚
            </a>
            <a class="btn secondary" href="{% url 'rentals:delete_cars' %}">
                <i class="fas fa-trash"></i> Î”Î¹Î±Î³ÏÎ±Ï†Î® ÎŸÏ‡Î·Î¼Î¬Ï„Ï‰Î½
            </a>
        </div>

        <!-- âœ… Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·: ÎœÎµÏ„ÏÎ·Ï„Î­Ï‚ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ "Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î‘Ï…Ï„Î¿ÎºÎ¯Î½Î·Ï„Î±" -->
        <div class="counts-summary">
            Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î±: <strong>{{ available_cars|length }}</strong>
            <span class="dot">â€¢</span>
            ÎÎ¿Î¹ÎºÎ¹Î±ÏƒÎ¼Î­Î½Î±: <strong>{{ rented_cars|length }}</strong>
        </div>

        <!-- ğŸš— Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± -->
        <div class="columns">
            <div class="column">
                <h2><i class="fas fa-car-side"></i> Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î‘Ï…Ï„Î¿ÎºÎ¯Î½Î·Ï„Î±</h2>
                {% if available_cars %}
                    <ul class="car-list">
                        {% for car in available_cars %}
                        <li class="car-row"
                            data-edit-url="{% url 'rentals:edit_car' car.id %}"
                            title="Î”Î¹Ï€Î»ÏŒ ÎºÎ»Î¹Îº Î³Î¹Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±">
                            <span class="rank">#{{ forloop.counter }}</span>
                            <span class="meta">
                                {{ car.brand }} {{ car.model }} â€” <strong>{{ car.license_plate|default:"â€”" }}</strong>
                                ({{ car.category }}, {{ car.fuel_type }})
                            </span>
                            {% if request_id %}
                                <a class="btn" href="{% url 'rentals:choose_car' request_id car.id %}"
                                   onclick="event.stopPropagation();">
                                    <i class="fas fa-check-circle"></i> Î•Ï€Î¹Î»Î¿Î³Î®
                                </a>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î¿Ï‡Î®Î¼Î±Ï„Î±.</p>
                {% endif %}
            </div>

            <!-- ğŸ“„ ÎÎ¿Î¹ÎºÎ¹Î±ÏƒÎ¼Î­Î½Î± -->
            <div class="column">
                <h2><i class="fas fa-file-contract"></i> ÎÎ¿Î¹ÎºÎ¹Î±ÏƒÎ¼Î­Î½Î± Î‘Ï…Ï„Î¿ÎºÎ¯Î½Î·Ï„Î±</h2>
                {% if rented_cars %}
                    <ul class="car-list">
                        {% for car in rented_cars %}
                        <li class="car-row"
                            data-edit-url="{% url 'rentals:edit_car' car.id %}"
                            title="Î”Î¹Ï€Î»ÏŒ ÎºÎ»Î¹Îº Î³Î¹Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±">
                            <span class="meta">
                                {{ car.brand }} {{ car.model }} â€” <strong>{{ car.license_plate|default:"â€”" }}</strong>
                                ({{ car.category }}, {{ car.fuel_type }})
                            </span>
                            {% if car.company.user == request.user %}
                                <a class="btn" href="{% url 'rentals:return_car' car.id %}"
                                   onclick="event.stopPropagation();">
                                    <i class="fas fa-undo"></i> Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î®
                                </a>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î½Î¿Î¹ÎºÎ¹Î±ÏƒÎ¼Î­Î½Î± Î¿Ï‡Î®Î¼Î±Ï„Î±.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
    // DD-MM-YYYY Î³Î¹Î± datepickers
    flatpickr(".datepicker", { dateFormat: "d-m-Y" });

    // Double-click Î³Î¹Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".car-row").forEach(function (row) {
            row.addEventListener("dblclick", function (e) {
                if (e.target.closest("a, button")) return;
                const url = row.dataset.editUrl;
                if (url) window.location.href = url;
            });
        });
    });

    function toggleTheme() {
        const body = document.body;
        const isDark = body.classList.toggle("dark");
        document.cookie = `theme=${isDark ? 'dark' : 'light'};path=/;max-age=31536000`;
    }
    function toggleSettingsMenu() {
        const menu = document.getElementById("settingsMenu");
        menu.classList.toggle("show");
    }
    window.addEventListener("click", function(event) {
        const menu = document.getElementById("settingsMenu");
        if (!event.target.closest('.settings-container')) {
            menu.classList.remove('show');
        }
    });
    (function () {
        const themeCookie = document.cookie.split('; ').find(r => r.startsWith('theme='));
        if (themeCookie && themeCookie.split('=')[1] === 'dark') {
            document.body.classList.add('dark');
        }
    })();
    </script>
</body>
</html>
